<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Monthly Tracker</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>

<h1>Monthly Overview</h1>

<!-- Top-Right Report Menu -->
<div class="menu-container">
  <button id="menu-btn">â˜° Reports</button>
  <div id="menu-dropdown" class="dropdown hidden">
      <button class="menu-item" data-type="daily">Daily Report (PDF)</button>
      <button class="menu-item" data-type="weekly">Weekly Report (PDF)</button>
      <button class="menu-item" data-type="monthly">Monthly Report (PDF)</button>
  </div>
</div>

<div class="wrapper">
  <!-- Daily summaries -->
</div>

<h2 style="text-align:center;margin-top:24px;">Monthly Completion Pie</h2>
<canvas id="monthly-chart"></canvas>

<script>
// ---------------- DAYS ----------------
const days = ['mon','tue','wed','thu','fri','sat','sun'];
const dayNames = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];
const wrapper = document.querySelector('.wrapper');

// ---------------- LOAD DAILY PROGRESS ----------------
function getDayProgress(day){
  let total = 0, done = 0;
  for(let i=0;i<50;i++){
    const val = localStorage.getItem(`${day}-${i}`);
    if(val===null) break;
    total++;
    if(val==='true') done++;
  }
  return total ? Math.round(done/total*100) : 0;
}

// ---------------- BUILD DAILY SUMMARIES ----------------
let monthlyDone = 0;
days.forEach((day,idx)=>{
  const pct = getDayProgress(day);
  monthlyDone += pct;

  const dayDiv = document.createElement('div');
  dayDiv.className = 'day-summary';
  dayDiv.style.background = '#001f4d'; // dark blue
  dayDiv.style.color = '#fff'; // super white
  dayDiv.innerHTML = `
    <h2>${dayNames[idx]}</h2>
    <div class="progress" style="width:${pct}%">${pct}%</div>
  `;
  wrapper.appendChild(dayDiv);
});

// ---------------- MONTHLY PIE ----------------
const monthlyPct = Math.round(monthlyDone/days.length);
const ctx = document.getElementById('monthly-chart').getContext('2d');
new Chart(ctx,{
  type:'doughnut',
  data:{
    labels:['Completed','Remaining'],
    datasets:[{data:[monthlyPct,100-monthlyPct],backgroundColor:['#0f4d0f','#555'] }]
  },
  options:{plugins:{legend:{display:true,labels:{color:'#fff'}}}}
});

// ---------------- MENU TOGGLE & PDF ----------------
const menuBtn = document.getElementById("menu-btn");
const dropdown = document.getElementById("menu-dropdown");

menuBtn.addEventListener("click",()=>dropdown.classList.toggle("hidden"));

document.addEventListener("click",(e)=>{
  if(!menuBtn.contains(e.target) && !dropdown.contains(e.target)){
    dropdown.classList.add("hidden");
  }
});

document.querySelectorAll(".menu-item").forEach(btn=>{
  btn.addEventListener("click", async ()=>{
    const type = btn.dataset.type;
    dropdown.classList.add("hidden");
    const element = document.body;
    const canvas = await html2canvas(element,{scale:2});
    const imgData = canvas.toDataURL("image/png");
    const pdf = new jspdf.jsPDF("p","mm","a4");
    const pageWidth = pdf.internal.pageSize.getWidth();
    const imgWidth = pageWidth;
    const imgHeight = canvas.height*(imgWidth/canvas.width);
    pdf.addImage(imgData,"PNG",0,0,imgWidth,imgHeight);
    pdf.save(`${type}-report.pdf`);
  });
});
</script>
</body>
</html>

