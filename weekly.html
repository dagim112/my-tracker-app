<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Weekly Tracker</title>
<link rel="stylesheet" href="style.css">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- html2canvas + jsPDF -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>

<h1>Weekly Overview (Monâ€“Sun)</h1>

<!-- Top-right Menu -->
<div class="menu-container">
  <button id="menu-btn">â˜° Reports</button>
  <div id="menu-dropdown" class="dropdown hidden">
      <button class="menu-item" data-type="daily">Daily Report (PDF)</button>
      <button class="menu-item" data-type="weekly">Weekly Report (PDF)</button>
      <button class="menu-item" data-type="monthly">Monthly Report (PDF)</button>
  </div>
</div>

<!-- Weekly progress bar -->
<div id="weekly-progress-container">
  <div id="weekly-progress">0%</div>
</div>

<div class="wrapper"></div>

<script>
// ========================= DATA =========================
const daysData = ['mon','tue','wed','thu','fri','sat','sun'];
const dayNames = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];
const wrapper = document.querySelector('.wrapper');

// ========================= LOCAL STORAGE =========================
function saveDayProgress(dayEl){
  const key = dayEl.dataset.day;
  dayEl.querySelectorAll('input[type="checkbox"]').forEach((cb,i)=>{
    localStorage.setItem(`${key}-${i}`,cb.checked);
  });
}

function loadDayProgress(dayEl){
  const key = dayEl.dataset.day;
  dayEl.querySelectorAll('input[type="checkbox"]').forEach((cb,i)=>{
    const val = localStorage.getItem(`${key}-${i}`);
    if(val==='true') cb.checked = true;
  });
}

// ========================= PERCENTAGES =========================
function calcDayPercent(dayEl){
  const checkboxes = Array.from(dayEl.querySelectorAll('input[type="checkbox"]'));
  const total = checkboxes.length;
  const done = checkboxes.filter(cb=>cb.checked).length;
  const percent = total ? Math.round(done/total*100) : 0;
  const pctEl = dayEl.querySelector('.day-percent');
  pctEl.textContent = percent+'%';
  return percent;
}

function updateWeeklyPercent(){
  const dayEls = document.querySelectorAll('.day');
  let totalUnits=0, doneUnits=0;
  dayEls.forEach(dayEl=>{
    const checkboxes = Array.from(dayEl.querySelectorAll('input[type="checkbox"]'));
    const done = checkboxes.filter(cb=>cb.checked).length;
    totalUnits += checkboxes.length;
    doneUnits += done;
  });
  const percent = totalUnits ? Math.round(doneUnits/totalUnits*100) : 0;
  document.getElementById('weekly-progress').style.width = percent+'%';
  document.getElementById('weekly-progress').textContent = percent+'%';
}

// ========================= BUILD DAYS =========================
const morningCharts = {};

daysData.forEach((day,idx)=>{
  const dayDiv = document.createElement('div');
  dayDiv.className='day';
  dayDiv.dataset.day = day;
  dayDiv.innerHTML = `
    <h2>${dayNames[idx]}</h2>
    <div class="day-percent">0%</div>
    <div class="day-content">
      <div class="task morning">
        ðŸŒž Morning Routine:
        <div class="morning-subtasks">
          <label><input type="checkbox"> Drink Water</label>
          <label><input type="checkbox"> Prayer / Meditation</label>
          <label><input type="checkbox"> Exercise</label>
          <label><input type="checkbox"> Reading / Learning</label>
        </div>
        <canvas id="chart-${day}"></canvas>
      </div>
      <div class="task">ðŸ’» Programming / Study <input type="checkbox"></div>
      <div class="task">ðŸ‡³ðŸ‡± Dutch Course <input type="checkbox"></div>
      <div class="task">ðŸ’» Review & Light Coding <input type="checkbox"></div>
      <textarea class="note-text" placeholder="Notes / Reason"></textarea>
    </div>`;
  wrapper.appendChild(dayDiv);

  loadDayProgress(dayDiv);
  calcDayPercent(dayDiv);
  updateWeeklyPercent();
  updateDayChart(dayDiv.dataset.day);

  // Toggle content
  dayDiv.querySelector('h2').addEventListener('click',()=>{
    const content = dayDiv.querySelector('.day-content');
    content.style.display = content.style.display==='block'?'none':'block';
  });

  // Checkbox listeners
  dayDiv.querySelectorAll('input[type="checkbox"]').forEach(cb=>{
    cb.addEventListener('change',()=>{
      saveDayProgress(dayDiv);
      calcDayPercent(dayDiv);
      updateWeeklyPercent();
      updateDayChart(dayDiv.dataset.day);
    });
  });
});

// ========================= PIE CHART =========================
function updateDayChart(day){
  const dayEl = document.querySelector(`.day[data-day="${day}"]`);
  const checkboxes = Array.from(dayEl.querySelectorAll('.morning-subtasks input[type="checkbox"]'));
  const done = checkboxes.filter(cb=>cb.checked).length;
  const remaining = checkboxes.length - done;
  const ctx = document.getElementById(`chart-${day}`).getContext('2d');
  if(morningCharts[day]) morningCharts[day].destroy();
  morningCharts[day] = new Chart(ctx,{
    type:'doughnut',
    data:{
      labels:['Done','Remaining'],
      datasets:[{data:[done,remaining], backgroundColor:['#0f4d0f','#555'] }]
    },
    options:{plugins:{legend:{display:true,labels:{color:'#fff'}}}}
  });
}

// ========================= MENU TOGGLE & PDF =========================
const menuBtn = document.getElementById("menu-btn");
const dropdown = document.getElementById("menu-dropdown");
menuBtn.addEventListener("click", () => dropdown.classList.toggle("hidden"));

document.addEventListener("click",(e)=>{
  if(!menuBtn.contains(e.target) && !dropdown.contains(e.target)){
    dropdown.classList.add("hidden");
  }
});

document.querySelectorAll(".menu-item").forEach(btn=>{
  btn.addEventListener("click", async ()=>{
    const type = btn.dataset.type;
    dropdown.classList.add("hidden");

    let element = document.body;
    const canvas = await html2canvas(element,{scale:2});
    const imgData = canvas.toDataURL("image/png");
    const pdf = new jspdf.jsPDF("p","mm","a4");
    const pageWidth = pdf.internal.pageSize.getWidth();
    const imgWidth = pageWidth;
    const imgHeight = canvas.height*(imgWidth/canvas.width);
    pdf.addImage(imgData,"PNG",0,0,imgWidth,imgHeight);
    pdf.save(`${type}-report.pdf`);
  });
});
</script>
</body>
</html>

